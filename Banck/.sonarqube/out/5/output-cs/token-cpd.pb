•
zD:\7. Septimo Semestre\7. Desarrollo de Software Seguro\TERCER PARCIAL\BankSystem\Banck\Service\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str "
)" #
]# $
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 !
)		! "
]		" #
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str 
) 
] 
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str $
)$ %
]% &
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 0
)0 1
]1 2
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
["" 
assembly"" 	
:""	 

AssemblyVersion"" 
("" 
$str"" $
)""$ %
]""% &
[## 
assembly## 	
:##	 

AssemblyFileVersion## 
(## 
$str## (
)##( )
]##) *◊
vD:\7. Septimo Semestre\7. Desarrollo de Software Seguro\TERCER PARCIAL\BankSystem\Banck\Service\Models\EmailRequest.cs
	namespace 	
Service
 
. 
Models 
{ 
public 

class 
EmailRequest 
{		 
public

 
string

 
Email

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
} 
} æ
nD:\7. Septimo Semestre\7. Desarrollo de Software Seguro\TERCER PARCIAL\BankSystem\Banck\Service\Global.asax.cs
	namespace 	
Service
 
{		 
public

 

class

 
WebApiApplication

 "
:

# $
System

% +
.

+ ,
Web

, /
.

/ 0
HttpApplication

0 ?
{ 
	protected 
void 
Application_Start (
(( )
)) *
{ 	
GlobalConfiguration 
.  
	Configure  )
() *
WebApiConfig* 6
.6 7
Register7 ?
)? @
;@ A
} 	
} 
} ı:
ÅD:\7. Septimo Semestre\7. Desarrollo de Software Seguro\TERCER PARCIAL\BankSystem\Banck\Service\Controllers\UserDataController.cs
	namespace 	
Service
 
. 
Controllers 
{		 
public

 

class

 
UserDataController

 #
:

$ %
ApiController

& 3
{ 
[ 	
HttpPost	 
] 
public 
IHttpActionResult  
CreateUserData! /
(/ 0
[0 1
FromBody1 9
]9 :
	User_Data; D
newUserDataE P
)P Q
{ 	
var 
userDataLogic 
= 
new  #
UserDataLogic$ 1
(1 2
)2 3
;3 4
var 
( 
success 
, 
message !
,! "
createdUserData# 2
)2 3
=4 5
userDataLogic6 C
.C D
CreateD J
(J K
newUserDataK V
)V W
;W X
if 
( 
success 
) 
{ 
return 
Ok 
( 
new 
{ 
Success  '
=( )
true* .
,. /
Message0 7
=8 9
message: A
,A B
UserDataC K
=L M
createdUserDataN ]
}^ _
)_ `
;` a
} 
else 
{ 
return 

BadRequest !
(! "
JsonConvert" -
.- .
SerializeObject. =
(= >
new> A
{B C
SuccessD K
=L M
falseN S
,S T
MessageU \
=] ^
message_ f
}g h
)h i
)i j
;j k
} 
} 	
[ 	
HttpGet	 
] 
public 
IHttpActionResult  
GetAllUserData! /
(/ 0
)0 1
{ 	
var 
userDataLogic 
= 
new  #
UserDataLogic$ 1
(1 2
)2 3
;3 4
var   
(   
success   
,   
message   !
,  ! "
userDataList  # /
)  / 0
=  1 2
userDataLogic  3 @
.  @ A
RetrieveAllUserData  A T
(  T U
)  U V
;  V W
if"" 
("" 
success"" 
)"" 
{## 
return$$ 
Ok$$ 
($$ 
new$$ 
{$$ 
Success$$  '
=$$( )
true$$* .
,$$. /
UserDataList$$0 <
=$$= >
userDataList$$? K
}$$L M
)$$M N
;$$N O
}%% 
else&& 
{'' 
return(( 
Content(( 
((( 
HttpStatusCode(( -
.((- .
InternalServerError((. A
,((A B
new((C F
{((G H
Success((I P
=((Q R
false((S X
,((X Y
Message((Z a
=((b c
message((d k
}((l m
)((m n
;((n o
})) 
}** 	
[,, 	
HttpGet,,	 
],, 
public-- 
IHttpActionResult--  
GetUserDataById--! 0
(--0 1
int--1 4
id--5 7
)--7 8
{.. 	
var// 
userDataLogic// 
=// 
new//  #
UserDataLogic//$ 1
(//1 2
)//2 3
;//3 4
var00 
(00 
success00 
,00 
message00 !
,00! "
userData00# +
)00+ ,
=00- .
userDataLogic00/ <
.00< = 
RetrieveByIdUserData00= Q
(00Q R
id00R T
)00T U
;00U V
if22 
(22 
success22 
)22 
{33 
return44 
Ok44 
(44 
new44 
{44 
Success44  '
=44( )
true44* .
,44. /
UserData440 8
=449 :
userData44; C
}44D E
)44E F
;44F G
}55 
else66 
{77 
return88 
Content88 
(88 
HttpStatusCode88 -
.88- .
NotFound88. 6
,886 7
new888 ;
{88< =
Success88> E
=88F G
false88H M
,88M N
Message88O V
=88W X
message88Y `
}88a b
)88b c
;88c d
}99 
}:: 	
[<< 	
HttpPost<<	 
]<< 
public== 
IHttpActionResult==  
DeleteUserData==! /
(==/ 0
int==0 3
id==4 6
)==6 7
{>> 	
var?? 
userDataLogic?? 
=?? 
new??  #
UserDataLogic??$ 1
(??1 2
)??2 3
;??3 4
var@@ 
(@@ 
success@@ 
,@@ 
message@@ !
)@@! "
=@@# $
userDataLogic@@% 2
.@@2 3
Delete@@3 9
(@@9 :
id@@: <
)@@< =
;@@= >
ifBB 
(BB 
successBB 
)BB 
{CC 
returnDD 
OkDD 
(DD 
newDD 
{DD 
SuccessDD  '
=DD( )
trueDD* .
,DD. /
MessageDD0 7
=DD8 9
messageDD: A
}DDB C
)DDC D
;DDD E
}EE 
elseFF 
{GG 
returnHH 
ContentHH 
(HH 
HttpStatusCodeHH -
.HH- .
NotFoundHH. 6
,HH6 7
newHH8 ;
{HH< =
SuccessHH> E
=HHF G
falseHHH M
,HHM N
MessageHHO V
=HHW X
messageHHY `
}HHa b
)HHb c
;HHc d
}II 
}JJ 	
[LL 	
HttpPutLL	 
]LL 
publicMM 
IHttpActionResultMM  
UpdateUserDataMM! /
(MM/ 0
[MM0 1
FromBodyMM1 9
]MM9 :
	User_DataMM; D
updatedUserDataMME T
)MMT U
{NN 	
varOO 
userDataLogicOO 
=OO 
newOO  #
UserDataLogicOO$ 1
(OO1 2
)OO2 3
;OO3 4
varPP 
(PP 
successPP 
,PP 
messagePP !
)PP! "
=PP# $
userDataLogicPP% 2
.PP2 3
UpdateUser_DataPP3 B
(PPB C
updatedUserDataPPC R
)PPR S
;PPS T
ifRR 
(RR 
successRR 
)RR 
{SS 
returnTT 
OkTT 
(TT 
newTT 
{TT 
SuccessTT  '
=TT( )
trueTT* .
,TT. /
MessageTT0 7
=TT8 9
messageTT: A
}TTB C
)TTC D
;TTD E
}UU 
elseVV 
{WW 
returnXX 
ContentXX 
(XX 
HttpStatusCodeXX -
.XX- .
NotFoundXX. 6
,XX6 7
newXX8 ;
{XX< =
SuccessXX> E
=XXF G
falseXXH M
,XXM N
MessageXXO V
=XXW X
messageXXY `
}XXa b
)XXb c
;XXc d
}YY 
}ZZ 	
}[[ 
}\\ Çπ
}D:\7. Septimo Semestre\7. Desarrollo de Software Seguro\TERCER PARCIAL\BankSystem\Banck\Service\Controllers\UserController.cs
	namespace 	
Service
 
. 
Controllers 
{ 
public 

class 
UserController 
:  !
ApiController" /
{ 
private 
static 

Dictionary !
<! "
string" (
,( )
string* 0
>0 1
VerificationCodes2 C
=D E
newF I

DictionaryJ T
<T U
stringU [
,[ \
string] c
>c d
(d e
)e f
;f g
private 
readonly 
IEmailService &
_emailService' 4
;4 5
public 
UserController 
( 
) 
{ 	
_emailService 
= 
new 
EmailService  ,
(, -
)- .
;. /
} 	
private 
static 

Dictionary !
<! "
string" (
,( )
User* .
>. / 
PendingRegistrations0 D
=E F
newG J

DictionaryK U
<U V
stringV \
,\ ]
User^ b
>b c
(c d
)d e
;e f
["" 	
HttpPost""	 
]"" 
public## 
async## 
Task## 
<## 
IHttpActionResult## +
>##+ ,

CreateUser##- 7
(##7 8
[##8 9
FromBody##9 A
]##A B
User##C G
newUser##H O
)##O P
{$$ 	
var%% 
BL%% 
=%% 
new%% 
	UserLogic%% "
(%%" #
)%%# $
;%%$ %
try'' 
{(( 
if** 
(** 
BL** 
.**  
validateExistingUser** +
(**+ ,
newUser**, 3
)**3 4
)**4 5
{++ 
return,, 
Content,, "
(,," #
HttpStatusCode,,# 1
.,,1 2

BadRequest,,2 <
,,,< =
new,,> A
{-- 
Success.. 
=..  !
false.." '
,..' (
Message// 
=//  !
$str//" ;
}00 
)00 
;00 
}11 
string33 
verificationCode33 '
=33( )
new33* -
Random33. 4
(334 5
)335 6
.336 7
Next337 ;
(33; <
$num33< B
,33B C
$num33D J
)33J K
.33K L
ToString33L T
(33T U
)33U V
;33V W
VerificationCodes66 !
[66! "
newUser66" )
.66) *
email66* /
]66/ 0
=661 2
verificationCode663 C
;66C D 
PendingRegistrations77 $
[77$ %
newUser77% ,
.77, -
email77- 2
]772 3
=774 5
newUser776 =
;77= >
string:: 
subject:: 
=::  
$str::! G
;::G H
string;; 
body;; 
=;; 
$";;  
$str;;  F
{;;F G
verificationCode;;G W
};;W X
$str;;X a
";;a b
;;;b c
await<< 
_emailService<< #
.<<# $
SendEmailAsync<<$ 2
(<<2 3
newUser<<3 :
.<<: ;
email<<; @
,<<@ A
subject<<B I
,<<I J
body<<K O
)<<O P
;<<P Q
var?? 
response?? 
=?? 
new?? " 
UserCreationResponse??# 7
{@@ 
UserAA 
=AA 
newUserAA "
,AA" #
SuccessBB 
=BB 
trueBB "
,BB" #
MessageCC 
=CC 
$str	CC Ä
}DD 
;DD 
returnFF 
OkFF 
(FF 
responseFF "
)FF" #
;FF# $
}GG 
catchHH 
(HH 
	ExceptionHH 
exHH 
)HH  
{II 
returnJJ 
ContentJJ 
(JJ 
HttpStatusCodeJJ -
.JJ- .
InternalServerErrorJJ. A
,JJA B
newJJC F
{KK 
SuccessLL 
=LL 
falseLL #
,LL# $
MessageMM 
=MM 
$strMM P
}NN 
)NN 
;NN 
}OO 
}PP 	
[TT 	
HttpPostTT	 
]TT 
publicUU 
IHttpActionResultUU  
VerifyAndCreateUserUU! 4
(UU4 5
[UU5 6
FromBodyUU6 >
]UU> ?
VerifyCodeRequestUU@ Q
verifyRequestUUR _
)UU_ `
{VV 	
varWW 
BLWW 
=WW 
newWW 
	UserLogicWW "
(WW" #
)WW# $
;WW$ %
ifZZ 
(ZZ 
VerificationCodesZZ !
.ZZ! "
TryGetValueZZ" -
(ZZ- .
verifyRequestZZ. ;
.ZZ; <
EmailZZ< A
,ZZA B
outZZC F
stringZZG M

storedCodeZZN X
)ZZX Y
&&ZZZ \

storedCodeZZ] g
==ZZh j
verifyRequestZZk x
.ZZx y
CodeZZy }
)ZZ} ~
{[[ 
VerificationCodes]] !
.]]! "
Remove]]" (
(]]( )
verifyRequest]]) 6
.]]6 7
Email]]7 <
)]]< =
;]]= >
if`` 
(``  
PendingRegistrations`` (
.``( )
TryGetValue``) 4
(``4 5
verifyRequest``5 B
.``B C
Email``C H
,``H I
out``J M
User``N R
newUser``S Z
)``Z [
)``[ \
{aa 
varcc 
createdUsercc #
=cc$ %
BLcc& (
.cc( )
Createcc) /
(cc/ 0
newUsercc0 7
)cc7 8
;cc8 9 
PendingRegistrationsff (
.ff( )
Removeff) /
(ff/ 0
verifyRequestff0 =
.ff= >
Emailff> C
)ffC D
;ffD E
returnjj 
Okjj 
(jj 
newjj !
{jj" #
Messagejj$ +
=jj, -
$strjj. L
,jjL M
UserjjN R
=jjS T
createdUserjjU `
}jja b
)jjb c
;jjc d
}kk 
elsell 
{mm 
returnnn 
Contentnn "
(nn" #
HttpStatusCodenn# 1
.nn1 2
NotFoundnn2 :
,nn: ;
newnn< ?
{nn@ A
MessagennB I
=nnJ K
$str	nnL É
}
nnÑ Ö
)
nnÖ Ü
;
nnÜ á
}oo 
}pp 
elseqq 
{rr 
returnss 
Contentss 
(ss 
HttpStatusCodess -
.ss- .
Unauthorizedss. :
,ss: ;
newss< ?
{ss@ A
MessagessB I
=ssJ K
$strssL y
}ssz {
)ss{ |
;ss| }
}tt 
}uu 	
[xx 	
HttpPostxx	 
]xx 
publicyy 
asyncyy 
Taskyy 
<yy 
IHttpActionResultyy +
>yy+ ,
Loginyy- 2
(yy2 3
[yy3 4
FromBodyyy4 <
]yy< =
LoginRequestyy> J
loginRequestyyK W
)yyW X
{zz 	
var{{ 
BL{{ 
={{ 
new{{ 
	UserLogic{{ "
({{" #
){{# $
;{{$ %
try}} 
{~~ 
var
ÄÄ 
user
ÄÄ 
=
ÄÄ 
BL
ÄÄ 
.
ÄÄ 
Authenticate
ÄÄ *
(
ÄÄ* +
loginRequest
ÄÄ+ 7
.
ÄÄ7 8
Email
ÄÄ8 =
,
ÄÄ= >
loginRequest
ÄÄ? K
.
ÄÄK L
Password
ÄÄL T
)
ÄÄT U
;
ÄÄU V
if
ÇÇ 
(
ÇÇ 
user
ÇÇ 
==
ÇÇ 
null
ÇÇ  
)
ÇÇ  !
{
ÉÉ 
return
ÑÑ 
Content
ÑÑ "
(
ÑÑ" #
HttpStatusCode
ÑÑ# 1
.
ÑÑ1 2
Unauthorized
ÑÑ2 >
,
ÑÑ> ?
new
ÑÑ@ C
{
ÑÑD E
Success
ÑÑF M
=
ÑÑN O
false
ÑÑP U
,
ÑÑU V
Message
ÑÑW ^
=
ÑÑ_ `
$str
ÑÑa |
}
ÑÑ} ~
)
ÑÑ~ 
;ÑÑ Ä
}
ÖÖ 
string
àà 
verificationCode
àà '
=
àà( )
new
àà* -
Random
àà. 4
(
àà4 5
)
àà5 6
.
àà6 7
Next
àà7 ;
(
àà; <
$num
àà< B
,
ààB C
$num
ààD J
)
ààJ K
.
ààK L
ToString
ààL T
(
ààT U
)
ààU V
;
ààV W
VerificationCodes
ãã !
[
ãã! "
loginRequest
ãã" .
.
ãã. /
Email
ãã/ 4
]
ãã4 5
=
ãã6 7
verificationCode
ãã8 H
;
ããH I
string
éé 
subject
éé 
=
éé  
$str
éé! 9
;
éé9 :
string
èè 
body
èè 
=
èè 
$"
èè  
$str
èè  F
{
èèF G
verificationCode
èèG W
}
èèW X
$str
èèX a
"
èèa b
;
èèb c
await
êê 
_emailService
êê #
.
êê# $
SendEmailAsync
êê$ 2
(
êê2 3
loginRequest
êê3 ?
.
êê? @
Email
êê@ E
,
êêE F
subject
êêG N
,
êêN O
body
êêP T
)
êêT U
;
êêU V
return
ìì 
Ok
ìì 
(
ìì 
new
ìì 
{
îî 
Success
ïï 
=
ïï 
true
ïï "
,
ïï" #
Email
ññ 
=
ññ 
loginRequest
ññ (
.
ññ( )
Email
ññ) .
,
ññ. /
Message
óó 
=
óó 
$str
óó x
}
òò 
)
òò 
;
òò 
}
ôô 
catch
öö 
(
öö 
	Exception
öö 
ex
öö 
)
öö  
{
õõ 
return
úú 
Content
úú 
(
úú 
HttpStatusCode
úú -
.
úú- .!
InternalServerError
úú. A
,
úúA B
new
úúC F
{
úúG H
Success
úúI P
=
úúQ R
false
úúS X
,
úúX Y
Message
úúZ a
=
úúb c
$str
úúd |
+
úú} ~
exúú Å
.úúÅ Ç
MessageúúÇ â
}úúä ã
)úúã å
;úúå ç
}
ùù 
}
ûû 	
[
££ 	
HttpPost
££	 
]
££ 
public
§§ 
IHttpActionResult
§§  

VerifyCode
§§! +
(
§§+ ,
[
§§, -
FromBody
§§- 5
]
§§5 6
VerifyCodeRequest
§§7 H
verifyRequest
§§I V
)
§§V W
{
•• 	
if
¶¶ 
(
¶¶ 
VerificationCodes
¶¶ !
.
¶¶! "
TryGetValue
¶¶" -
(
¶¶- .
verifyRequest
¶¶. ;
.
¶¶; <
Email
¶¶< A
,
¶¶A B
out
¶¶C F
string
¶¶G M

storedCode
¶¶N X
)
¶¶X Y
&&
¶¶Z \

storedCode
¶¶] g
==
¶¶h j
verifyRequest
¶¶k x
.
¶¶x y
Code
¶¶y }
)
¶¶} ~
{
ßß 
string
¨¨ 
userRole
¨¨ 
=
¨¨  !
$str
¨¨" (
;
¨¨( )
var
ØØ 
token
ØØ 
=
ØØ 

JwtService
ØØ &
.
ØØ& '
GenerateToken
ØØ' 4
(
ØØ4 5
verifyRequest
ØØ5 B
.
ØØB C
Email
ØØC H
,
ØØH I
userRole
ØØJ R
)
ØØR S
;
ØØS T
return
±± 
Ok
±± 
(
±± 
new
±± 
{
≤≤ 
Token
≥≥ 
=
≥≥ 
token
≥≥ !
,
≥≥! "
Email
¥¥ 
=
¥¥ 
verifyRequest
¥¥ )
.
¥¥) *
Email
¥¥* /
,
¥¥/ 0
Role
µµ 
=
µµ 
userRole
µµ #
,
µµ# $
Message
∂∂ 
=
∂∂ 
$str
∂∂ -
}
∑∑ 
)
∑∑ 
;
∑∑ 
}
∏∏ 
else
ππ 
{
∫∫ 
return
ªª 
Content
ªª 
(
ªª 
HttpStatusCode
ªª -
.
ªª- .
Unauthorized
ªª. :
,
ªª: ;
new
ªª< ?
{
ªª@ A
Message
ªªB I
=
ªªJ K
$str
ªªL y
}
ªªz {
)
ªª{ |
;
ªª| }
}
ºº 
}
ΩΩ 	
[
√√ 	
HttpGet
√√	 
]
√√ 
public
ƒƒ 
IHttpActionResult
ƒƒ  
GetAllUsers
ƒƒ! ,
(
ƒƒ, -
)
ƒƒ- .
{
≈≈ 	
var
∆∆ 
	userLogic
∆∆ 
=
∆∆ 
new
∆∆ 
	UserLogic
∆∆  )
(
∆∆) *
)
∆∆* +
;
∆∆+ ,
var
«« 
(
«« 
success
«« 
,
«« 
message
«« !
,
««! "
users
««# (
)
««( )
=
««* +
	userLogic
««, 5
.
««5 6
RetrieveAllUser
««6 E
(
««E F
)
««F G
;
««G H
if
…… 
(
…… 
success
…… 
)
…… 
{
   
return
ÀÀ 
Ok
ÀÀ 
(
ÀÀ 
new
ÀÀ 
{
ÀÀ 
Success
ÀÀ  '
=
ÀÀ( )
true
ÀÀ* .
,
ÀÀ. /
Users
ÀÀ0 5
=
ÀÀ6 7
users
ÀÀ8 =
}
ÀÀ> ?
)
ÀÀ? @
;
ÀÀ@ A
}
ÃÃ 
else
ÕÕ 
{
ŒŒ 
return
œœ 
Content
œœ 
(
œœ 
HttpStatusCode
œœ -
.
œœ- .!
InternalServerError
œœ. A
,
œœA B
new
œœC F
{
œœG H
Success
œœI P
=
œœQ R
false
œœS X
,
œœX Y
Message
œœZ a
=
œœb c
message
œœd k
}
œœl m
)
œœm n
;
œœn o
}
–– 
}
—— 	
[
”” 	
HttpGet
””	 
]
”” 
public
‘‘ 
IHttpActionResult
‘‘  
GetUserById
‘‘! ,
(
‘‘, -
int
‘‘- 0
id
‘‘1 3
)
‘‘3 4
{
’’ 	
var
÷÷ 
	userLogic
÷÷ 
=
÷÷ 
new
÷÷ 
	UserLogic
÷÷  )
(
÷÷) *
)
÷÷* +
;
÷÷+ ,
var
◊◊ 
(
◊◊ 
success
◊◊ 
,
◊◊ 
message
◊◊ !
,
◊◊! "
user
◊◊# '
)
◊◊' (
=
◊◊) *
	userLogic
◊◊+ 4
.
◊◊4 5
RetrieveByIdUser
◊◊5 E
(
◊◊E F
id
◊◊F H
)
◊◊H I
;
◊◊I J
if
ŸŸ 
(
ŸŸ 
success
ŸŸ 
)
ŸŸ 
{
⁄⁄ 
return
€€ 
Ok
€€ 
(
€€ 
new
€€ 
{
€€ 
Success
€€  '
=
€€( )
true
€€* .
,
€€. /
User
€€0 4
=
€€5 6
user
€€7 ;
}
€€< =
)
€€= >
;
€€> ?
}
‹‹ 
else
›› 
{
ﬁﬁ 
return
ﬂﬂ 
Content
ﬂﬂ 
(
ﬂﬂ 
HttpStatusCode
ﬂﬂ -
.
ﬂﬂ- .
NotFound
ﬂﬂ. 6
,
ﬂﬂ6 7
new
ﬂﬂ8 ;
{
ﬂﬂ< =
Success
ﬂﬂ> E
=
ﬂﬂF G
false
ﬂﬂH M
,
ﬂﬂM N
Message
ﬂﬂO V
=
ﬂﬂW X
message
ﬂﬂY `
}
ﬂﬂa b
)
ﬂﬂb c
;
ﬂﬂc d
}
‡‡ 
}
·· 	
[
„„ 	
HttpPost
„„	 
]
„„ 
public
‰‰ 
IHttpActionResult
‰‰  

DeleteUser
‰‰! +
(
‰‰+ ,
int
‰‰, /
id
‰‰0 2
)
‰‰2 3
{
ÂÂ 	
var
ÊÊ 
	userLogic
ÊÊ 
=
ÊÊ 
new
ÊÊ 
	UserLogic
ÊÊ  )
(
ÊÊ) *
)
ÊÊ* +
;
ÊÊ+ ,
var
ÁÁ 
(
ÁÁ 
success
ÁÁ 
,
ÁÁ 
message
ÁÁ !
)
ÁÁ! "
=
ÁÁ# $
	userLogic
ÁÁ% .
.
ÁÁ. /
Delete
ÁÁ/ 5
(
ÁÁ5 6
id
ÁÁ6 8
)
ÁÁ8 9
;
ÁÁ9 :
if
ÈÈ 
(
ÈÈ 
success
ÈÈ 
)
ÈÈ 
{
ÍÍ 
return
ÎÎ 
Ok
ÎÎ 
(
ÎÎ 
new
ÎÎ 
{
ÎÎ 
Success
ÎÎ  '
=
ÎÎ( )
true
ÎÎ* .
,
ÎÎ. /
Message
ÎÎ0 7
=
ÎÎ8 9
message
ÎÎ: A
}
ÎÎB C
)
ÎÎC D
;
ÎÎD E
}
ÏÏ 
else
ÌÌ 
{
ÓÓ 
return
ÔÔ 
Content
ÔÔ 
(
ÔÔ 
HttpStatusCode
ÔÔ -
.
ÔÔ- .
NotFound
ÔÔ. 6
,
ÔÔ6 7
new
ÔÔ8 ;
{
ÔÔ< =
Success
ÔÔ> E
=
ÔÔF G
false
ÔÔH M
,
ÔÔM N
Message
ÔÔO V
=
ÔÔW X
message
ÔÔY `
}
ÔÔa b
)
ÔÔb c
;
ÔÔc d
}
 
}
ÒÒ 	
[
ıı 	
HttpPut
ıı	 
]
ıı 
public
ˆˆ 
IHttpActionResult
ˆˆ  

UpdateUser
ˆˆ! +
(
ˆˆ+ ,
int
ˆˆ, /
id
ˆˆ0 2
,
ˆˆ2 3
[
ˆˆ4 5
FromBody
ˆˆ5 =
]
ˆˆ= >
User
ˆˆ? C
updatedUser
ˆˆD O
)
ˆˆO P
{
˜˜ 	
var
¯¯ 
	userLogic
¯¯ 
=
¯¯ 
new
¯¯ 
	UserLogic
¯¯  )
(
¯¯) *
)
¯¯* +
;
¯¯+ ,
try
˙˙ 
{
˚˚ 
var
˝˝ 
(
˝˝ 
successRetrieve
˝˝ $
,
˝˝$ %
messageRetrieve
˝˝& 5
,
˝˝5 6
existingUser
˝˝7 C
)
˝˝C D
=
˝˝E F
	userLogic
˝˝G P
.
˝˝P Q
RetrieveByIdUser
˝˝Q a
(
˝˝a b
id
˝˝b d
)
˝˝d e
;
˝˝e f
if
˛˛ 
(
˛˛ 
!
˛˛ 
successRetrieve
˛˛ $
)
˛˛$ %
{
ˇˇ 
return
ÄÄ 
Content
ÄÄ "
(
ÄÄ" #
HttpStatusCode
ÄÄ# 1
.
ÄÄ1 2
NotFound
ÄÄ2 :
,
ÄÄ: ;
new
ÄÄ< ?
{
ÄÄ@ A
Success
ÄÄB I
=
ÄÄJ K
false
ÄÄL Q
,
ÄÄQ R
Message
ÄÄS Z
=
ÄÄ[ \
messageRetrieve
ÄÄ] l
}
ÄÄm n
)
ÄÄn o
;
ÄÄo p
}
ÅÅ 
existingUser
ÑÑ 
.
ÑÑ 

first_name
ÑÑ '
=
ÑÑ( )
updatedUser
ÑÑ* 5
.
ÑÑ5 6

first_name
ÑÑ6 @
??
ÑÑA C
existingUser
ÑÑD P
.
ÑÑP Q

first_name
ÑÑQ [
;
ÑÑ[ \
existingUser
ÖÖ 
.
ÖÖ 
	last_name
ÖÖ &
=
ÖÖ' (
updatedUser
ÖÖ) 4
.
ÖÖ4 5
	last_name
ÖÖ5 >
??
ÖÖ? A
existingUser
ÖÖB N
.
ÖÖN O
	last_name
ÖÖO X
;
ÖÖX Y
existingUser
ÜÜ 
.
ÜÜ 

birth_date
ÜÜ '
=
ÜÜ( )
updatedUser
ÜÜ* 5
.
ÜÜ5 6

birth_date
ÜÜ6 @
!=
ÜÜA C
default
ÜÜD K
(
ÜÜK L
DateTime
ÜÜL T
)
ÜÜT U
?
ÜÜV W
updatedUser
ÜÜX c
.
ÜÜc d

birth_date
ÜÜd n
:
ÜÜo p
existingUser
ÜÜq }
.
ÜÜ} ~

birth_dateÜÜ~ à
;ÜÜà â
existingUser
áá 
.
áá 
address
áá $
=
áá% &
updatedUser
áá' 2
.
áá2 3
address
áá3 :
??
áá; =
existingUser
áá> J
.
ááJ K
address
ááK R
;
ááR S
existingUser
àà 
.
àà 
email
àà "
=
àà# $
updatedUser
àà% 0
.
àà0 1
email
àà1 6
??
àà7 9
existingUser
àà: F
.
ààF G
email
ààG L
;
ààL M
existingUser
ââ 
.
ââ 
role
ââ !
=
ââ" #
updatedUser
ââ$ /
.
ââ/ 0
role
ââ0 4
??
ââ5 7
existingUser
ââ8 D
.
ââD E
role
ââE I
;
ââI J
existingUser
ää 
.
ää 
password
ää %
=
ää& '
updatedUser
ää( 3
.
ää3 4
password
ää4 <
??
ää= ?
existingUser
ää@ L
.
ääL M
password
ääM U
;
ääU V
existingUser
ãã 
.
ãã 
registration_date
ãã .
=
ãã/ 0
updatedUser
ãã1 <
.
ãã< =
registration_date
ãã= N
??
ããO Q
existingUser
ããR ^
.
ãã^ _
registration_date
ãã_ p
;
ããp q
existingUser
åå 
.
åå "
account_locked_until
åå 1
=
åå2 3
updatedUser
åå4 ?
.
åå? @"
account_locked_until
åå@ T
??
ååU W
existingUser
ååX d
.
ååd e"
account_locked_until
ååe y
;
ååy z
existingUser
çç 
.
çç #
failed_login_attempts
çç 2
=
çç3 4
updatedUser
çç5 @
.
çç@ A#
failed_login_attempts
ççA V
??
ççW Y
existingUser
ççZ f
.
ççf g#
failed_login_attempts
ççg |
;
çç| }
existingUser
éé 
.
éé 
status
éé #
=
éé$ %
updatedUser
éé& 1
.
éé1 2
status
éé2 8
??
éé9 ;
existingUser
éé< H
.
ééH I
status
ééI O
;
ééO P
var
ëë 
(
ëë 
successUpdate
ëë "
,
ëë" #
messageUpdate
ëë$ 1
)
ëë1 2
=
ëë3 4
	userLogic
ëë5 >
.
ëë> ?

UpdateUser
ëë? I
(
ëëI J
existingUser
ëëJ V
)
ëëV W
;
ëëW X
if
ìì 
(
ìì 
!
ìì 
successUpdate
ìì "
)
ìì" #
{
îî 
return
ïï 
Content
ïï "
(
ïï" #
HttpStatusCode
ïï# 1
.
ïï1 2!
InternalServerError
ïï2 E
,
ïïE F
new
ïïG J
{
ïïK L
Success
ïïM T
=
ïïU V
false
ïïW \
,
ïï\ ]
Message
ïï^ e
=
ïïf g
messageUpdate
ïïh u
}
ïïv w
)
ïïw x
;
ïïx y
}
ññ 
return
òò 
Ok
òò 
(
òò 
new
òò 
{
òò 
Success
òò  '
=
òò( )
true
òò* .
,
òò. /
Message
òò0 7
=
òò8 9
messageUpdate
òò: G
,
òòG H
User
òòI M
=
òòN O
existingUser
òòP \
}
òò] ^
)
òò^ _
;
òò_ `
}
ôô 
catch
öö 
(
öö 
	Exception
öö 
ex
öö 
)
öö  
{
õõ 
return
úú 
Content
úú 
(
úú 
HttpStatusCode
úú -
.
úú- .!
InternalServerError
úú. A
,
úúA B
new
úúC F
{
úúG H
Success
úúI P
=
úúQ R
false
úúS X
,
úúX Y
Message
úúZ a
=
úúb c
$str
úúd |
+
úú} ~
exúú Å
.úúÅ Ç
MessageúúÇ â
}úúä ã
)úúã å
;úúå ç
}
ùù 
}
ûû 	
}
°° 
}¢¢ Ω9
}D:\7. Septimo Semestre\7. Desarrollo de Software Seguro\TERCER PARCIAL\BankSystem\Banck\Service\Controllers\LoanController.cs
	namespace 	
Service
 
. 
Controllers 
{ 
public		 

class		 
LoanController		 
:		  !
ApiController		" /
{

 
[ 	
HttpPost	 
] 
public 
IHttpActionResult  

CreateLoan! +
(+ ,
[, -
FromBody- 5
]5 6
Loan7 ;
newLoan< C
)C D
{ 	
var 
	loanLogic 
= 
new 
	LoanLogic  )
() *
)* +
;+ ,
var 
( 
success 
, 
message !
,! "
createdLoan# .
). /
=0 1
	loanLogic2 ;
.; <
Create< B
(B C
newLoanC J
)J K
;K L
if 
( 
success 
) 
{ 
return 
Ok 
( 
new 
{ 
Success  '
=( )
true* .
,. /
Message0 7
=8 9
message: A
,A B
LoanC G
=H I
createdLoanJ U
}V W
)W X
;X Y
} 
else 
{ 
return 

BadRequest !
(! "
JsonConvert" -
.- .
SerializeObject. =
(= >
new> A
{B C
SuccessD K
=L M
falseN S
,S T
MessageU \
=] ^
message_ f
}g h
)h i
)i j
;j k
} 
} 	
[ 	
HttpGet	 
] 
public 
IHttpActionResult  
GetAllLoans! ,
(, -
)- .
{ 	
var 
	loanLogic 
= 
new 
	LoanLogic  )
() *
)* +
;+ ,
var 
( 
success 
, 
message !
,! "
loans# (
)( )
=* +
	loanLogic, 5
.5 6
RetrieveAllLoan6 E
(E F
)F G
;G H
if!! 
(!! 
success!! 
)!! 
{"" 
return## 
Ok## 
(## 
new## 
{## 
Success##  '
=##( )
true##* .
,##. /
Loans##0 5
=##6 7
loans##8 =
}##> ?
)##? @
;##@ A
}$$ 
else%% 
{&& 
return'' 
Content'' 
('' 
HttpStatusCode'' -
.''- .
InternalServerError''. A
,''A B
new''C F
{''G H
Success''I P
=''Q R
false''S X
,''X Y
Message''Z a
=''b c
message''d k
}''l m
)''m n
;''n o
}(( 
})) 	
[++ 	
HttpGet++	 
]++ 
public,, 
IHttpActionResult,,  
GetLoanById,,! ,
(,,, -
int,,- 0
id,,1 3
),,3 4
{-- 	
var.. 
	loanLogic.. 
=.. 
new.. 
	LoanLogic..  )
(..) *
)..* +
;..+ ,
var// 
(// 
success// 
,// 
message// !
,//! "
loan//# '
)//' (
=//) *
	loanLogic//+ 4
.//4 5
RetrieveByIdLoan//5 E
(//E F
id//F H
)//H I
;//I J
if11 
(11 
success11 
)11 
{22 
return33 
Ok33 
(33 
new33 
{33 
Success33  '
=33( )
true33* .
,33. /
Loan330 4
=335 6
loan337 ;
}33< =
)33= >
;33> ?
}44 
else55 
{66 
return77 
Content77 
(77 
HttpStatusCode77 -
.77- .
NotFound77. 6
,776 7
new778 ;
{77< =
Success77> E
=77F G
false77H M
,77M N
Message77O V
=77W X
message77Y `
}77a b
)77b c
;77c d
}88 
}99 	
[;; 	

HttpDelete;;	 
];; 
public<< 
IHttpActionResult<<  

DeleteLoan<<! +
(<<+ ,
int<<, /
id<<0 2
)<<2 3
{== 	
var>> 
	loanLogic>> 
=>> 
new>> 
	LoanLogic>>  )
(>>) *
)>>* +
;>>+ ,
var?? 
(?? 
success?? 
,?? 
message?? !
)??! "
=??# $
	loanLogic??% .
.??. /
Delete??/ 5
(??5 6
id??6 8
)??8 9
;??9 :
ifAA 
(AA 
successAA 
)AA 
{BB 
returnCC 
OkCC 
(CC 
newCC 
{CC 
SuccessCC  '
=CC( )
trueCC* .
,CC. /
MessageCC0 7
=CC8 9
messageCC: A
}CCB C
)CCC D
;CCD E
}DD 
elseEE 
{FF 
returnGG 
ContentGG 
(GG 
HttpStatusCodeGG -
.GG- .
NotFoundGG. 6
,GG6 7
newGG8 ;
{GG< =
SuccessGG> E
=GGF G
falseGGH M
,GGM N
MessageGGO V
=GGW X
messageGGY `
}GGa b
)GGb c
;GGc d
}HH 
}II 	
[KK 	
HttpPutKK	 
]KK 
publicLL 
IHttpActionResultLL  

UpdateLoanLL! +
(LL+ ,
[LL, -
FromBodyLL- 5
]LL5 6
LoanLL7 ;
loanLL< @
)LL@ A
{MM 	
varNN 
	loanLogicNN 
=NN 
newNN 
	LoanLogicNN  )
(NN) *
)NN* +
;NN+ ,
varOO 
(OO 
successOO 
,OO 
messageOO !
)OO! "
=OO# $
	loanLogicOO% .
.OO. /

UpdateLoanOO/ 9
(OO9 :
loanOO: >
)OO> ?
;OO? @
ifQQ 
(QQ 
successQQ 
)QQ 
{RR 
returnSS 
OkSS 
(SS 
newSS 
{SS 
SuccessSS  '
=SS( )
trueSS* .
,SS. /
MessageSS0 7
=SS8 9
messageSS: A
}SSB C
)SSC D
;SSD E
}TT 
elseUU 
{VV 
returnWW 
ContentWW 
(WW 
HttpStatusCodeWW -
.WW- .
NotFoundWW. 6
,WW6 7
newWW8 ;
{WW< =
SuccessWW> E
=WWF G
falseWWH M
,WWM N
MessageWWO V
=WWW X
messageWWY `
}WWa b
)WWb c
;WWc d
}XX 
}YY 	
}ZZ 
}[[ ñ?
ÑD:\7. Septimo Semestre\7. Desarrollo de Software Seguro\TERCER PARCIAL\BankSystem\Banck\Service\Controllers\AmortizatioController.cs
	namespace 	
Service
 
. 
Controllers 
{		 
public

 

class

 "
AmortizationController

 '
:

( )
ApiController

* 7
{ 
[ 	
HttpPost	 
] 
public 
IHttpActionResult  
CreateAmortization! 3
(3 4
[4 5
FromBody5 =
]= >
Amortization? K
newAmortizationL [
)[ \
{ 	
var 
amortizationLogic !
=" #
new$ '
AmortizationLogic( 9
(9 :
): ;
;; <
var 
( 
success 
, 
message !
,! "
createdAmortization# 6
)6 7
=8 9
amortizationLogic: K
.K L
CreateAmortizationL ^
(^ _
newAmortization_ n
)n o
;o p
if 
( 
success 
) 
{ 
return 
Ok 
( 
new 
{ 
Success  '
=( )
true* .
,. /
Message0 7
=8 9
message: A
,A B
AmortizationC O
=P Q
createdAmortizationR e
}f g
)g h
;h i
} 
else 
{ 
return 

BadRequest !
(! "
JsonConvert" -
.- .
SerializeObject. =
(= >
new> A
{B C
SuccessD K
=L M
falseN S
,S T
MessageU \
=] ^
message_ f
}g h
)h i
)i j
;j k
} 
} 	
[ 	
HttpGet	 
] 
public 
IHttpActionResult  
GetAllAmortizations! 4
(4 5
)5 6
{   	
var!! 
amortizationLogic!! !
=!!" #
new!!$ '
AmortizationLogic!!( 9
(!!9 :
)!!: ;
;!!; <
var"" 
("" 
success"" 
,"" 
message"" !
,""! "
amortizations""# 0
)""0 1
=""2 3
amortizationLogic""4 E
.""E F#
RetrieveAllAmortization""F ]
(""] ^
)""^ _
;""_ `
if$$ 
($$ 
success$$ 
)$$ 
{%% 
return&& 
Ok&& 
(&& 
new&& 
{&& 
Success&&  '
=&&( )
true&&* .
,&&. /
Amortizations&&0 =
=&&> ?
amortizations&&@ M
}&&N O
)&&O P
;&&P Q
}'' 
else(( 
{)) 
return** 
Content** 
(** 
HttpStatusCode** -
.**- .
NotFound**. 6
,**6 7
JsonConvert**8 C
.**C D
SerializeObject**D S
(**S T
new**T W
{**X Y
Success**Z a
=**b c
false**d i
,**i j
Message**k r
=**s t
message**u |
}**} ~
)**~ 
)	** Ä
;
**Ä Å
}++ 
},, 	
[// 	
HttpGet//	 
]// 
public00 
IHttpActionResult00  
GetAmortizationById00! 4
(004 5
int005 8
id009 ;
)00; <
{11 	
var22 
amortizationLogic22 !
=22" #
new22$ '
AmortizationLogic22( 9
(229 :
)22: ;
;22; <
var33 
(33 
success33 
,33 
message33 !
,33! "
amortization33# /
)33/ 0
=331 2
amortizationLogic333 D
.33D E$
RetrieveByIdAmortization33E ]
(33] ^
id33^ `
)33` a
;33a b
if55 
(55 
success55 
)55 
{66 
return77 
Ok77 
(77 
new77 
{77 
Success77  '
=77( )
true77* .
,77. /
Amortization770 <
=77= >
amortization77? K
}77L M
)77M N
;77N O
}88 
else99 
{:: 
return;; 
Content;; 
(;; 
HttpStatusCode;; -
.;;- .
NotFound;;. 6
,;;6 7
JsonConvert;;8 C
.;;C D
SerializeObject;;D S
(;;S T
new;;T W
{;;X Y
Success;;Z a
=;;b c
false;;d i
,;;i j
Message;;k r
=;;s t
message;;u |
};;} ~
);;~ 
)	;; Ä
;
;;Ä Å
}<< 
}== 	
[@@ 	

HttpDelete@@	 
]@@ 
publicAA 
IHttpActionResultAA  
DeleteAmortizationAA! 3
(AA3 4
intAA4 7
idAA8 :
)AA: ;
{BB 	
varCC 
amortizationLogicCC !
=CC" #
newCC$ '
AmortizationLogicCC( 9
(CC9 :
)CC: ;
;CC; <
varDD 
(DD 
successDD 
,DD 
messageDD !
)DD! "
=DD# $
amortizationLogicDD% 6
.DD6 7
DeleteDD7 =
(DD= >
idDD> @
)DD@ A
;DDA B
ifFF 
(FF 
successFF 
)FF 
{GG 
returnHH 
OkHH 
(HH 
newHH 
{HH 
SuccessHH  '
=HH( )
trueHH* .
,HH. /
MessageHH0 7
=HH8 9
messageHH: A
}HHB C
)HHC D
;HHD E
}II 
elseJJ 
{KK 
returnLL 
ContentLL 
(LL 
HttpStatusCodeLL -
.LL- .
NotFoundLL. 6
,LL6 7
JsonConvertLL8 C
.LLC D
SerializeObjectLLD S
(LLS T
newLLT W
{LLX Y
SuccessLLZ a
=LLb c
falseLLd i
,LLi j
MessageLLk r
=LLs t
messageLLu |
}LL} ~
)LL~ 
)	LL Ä
;
LLÄ Å
}MM 
}NN 	
[QQ 	
HttpPutQQ	 
]QQ 
publicRR 
IHttpActionResultRR  
UpdateAmortizationRR! 3
(RR3 4
[RR4 5
FromBodyRR5 =
]RR= >
AmortizationRR? K
amortizationRRL X
)RRX Y
{SS 	
varTT 
amortizationLogicTT !
=TT" #
newTT$ '
AmortizationLogicTT( 9
(TT9 :
)TT: ;
;TT; <
varUU 
(UU 
successUU 
,UU 
messageUU !
)UU! "
=UU# $
amortizationLogicUU% 6
.UU6 7
UpdateAmortizationUU7 I
(UUI J
amortizationUUJ V
)UUV W
;UUW X
ifWW 
(WW 
successWW 
)WW 
{XX 
returnYY 
OkYY 
(YY 
newYY 
{YY 
SuccessYY  '
=YY( )
trueYY* .
,YY. /
MessageYY0 7
=YY8 9
messageYY: A
}YYB C
)YYC D
;YYD E
}ZZ 
else[[ 
{\\ 
return]] 
Content]] 
(]] 
HttpStatusCode]] -
.]]- .
NotFound]]. 6
,]]6 7
JsonConvert]]8 C
.]]C D
SerializeObject]]D S
(]]S T
new]]T W
{]]X Y
Success]]Z a
=]]b c
false]]d i
,]]i j
Message]]k r
=]]s t
message]]u |
}]]} ~
)]]~ 
)	]] Ä
;
]]Ä Å
}^^ 
}__ 	
}`` 
}aa ‚
yD:\7. Septimo Semestre\7. Desarrollo de Software Seguro\TERCER PARCIAL\BankSystem\Banck\Service\App_Start\WebApiConfig.cs
	namespace 	
Service
 
{ 
public		 

static		 
class		 
WebApiConfig		 $
{

 
public 
static 
void 
Register #
(# $
HttpConfiguration$ 5
config6 <
)< =
{ 	
config 
. 

Formatters 
. 
Remove $
($ %
config% +
.+ ,

Formatters, 6
.6 7
XmlFormatter7 C
)C D
;D E
config 
. 

Formatters 
. 
JsonFormatter +
.+ ,
SerializerSettings, >
.> ?!
ReferenceLoopHandling? T
=U V!
ReferenceLoopHandlingW l
.l m
Ignorem s
;s t
config 
. 

Formatters 
. 
JsonFormatter +
.+ ,
SerializerSettings, >
.> ?

Formatting? I
=J K

FormattingL V
.V W
IndentedW _
;_ `
config 
. "
MapHttpAttributeRoutes )
() *
)* +
;+ ,
config 
. 
Routes 
. 
MapHttpRoute &
(& '
name 
: 
$str "
," #
routeTemplate 
: 
$str ?
,? @
defaults 
: 
new 
{ 
id  "
=# $
RouteParameter% 3
.3 4
Optional4 <
}= >
) 
; 
} 	
} 
}   